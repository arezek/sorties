{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}

    <div class="enTeteAfficherSortie">
        <h2>Sorties : </h2>
        <h5>Date du jour : {{ "now" | date('y-m-d') }}{% if app.user %} - {{  app.user.prenom }} {{ app.user.nom }}{% endif %}</h5>
        <div>
            {% if app.user %}
                <button type="submit"><a class="btnNav" href="{{ path('sortie_new') }}">Creer une sortie</a>
                </button>
            {% elseif app.user == false %}
                <button type="submit"><a class="btnNav" href="{{ path('app_login') }}">Me connecter pour créer une sortie</a>
                </button>
            {% endif %}
        </div>
    </div>
    <div>
        <div>
            Campus :
            <select>
                {% for campus in campuses %}
                    <option value="{{campus.nom}}">{{campus.nom}}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label>Le nom de la sortie contient : </label>
            <input>
        </div>
        <div>
            <label>Entre : </label>
            <input type="date" >
            <img alt="logo calendrier">
            <label>et</label>
            <input type="date">
            <img alt="logo calendrier">
        </div>
    </div>
    <div>
        <input type="checkbox" value="3" checked>
        <label >Nouveautés</label>
        <input type="checkbox" value="1">
        <label>Organisateur-trice</label>
        <input type="checkbox" value="2">
        <label>Inscrit-e</label>
        <input type="checkbox" value="4">
        <label>Joyeux Souvenirs</label>
    </div>
    <div>
        <button type="submit">Rechercher</button>
    </div>


    {# FORMULAIRE SORTIE #}

    <h1>Sortie index</h1>

    <table class="table">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Date de la sortie</th>
                <th>Clôture</th>
                <th>Inscrits/places</th>
                <th>Etat</th>
                <th>Inscrit</th>
                <th>Organisateur</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for sortie in sorties %}
            <tr>
                <td><a href="{{ path('sortie_show',{ id : sortie.id}) }}">{{ sortie.nom }}</a></td>
                <td>{{ sortie.dateHeureDebut ? sortie.dateHeureDebut|date('d/m/Y H:i') : '' }}</td>
                <td>{{ sortie.dateLimiteInscription ? sortie.dateLimiteInscription|date('d/m/Y H:i') : '' }}</td>
                {# todo: Mettre le nombre d'inscrits avant le / (|lenght ?) #}
                <td>{participants} / {{ sortie.nbInscriptionsMax }}</td>
                <td>
                    {% if sortie.etat == 'Annulé' %}
                        Annulée
                    {% endif %}
                    {% if sortie.etat == 'Créée' %}
                        En création
                    {% endif %}
                    {% if sortie.etat == 'Ouverte' %}
                        Ouverte
                    {% endif %}
                    {% if sortie.etat == 'Cloturé' or sortie.etat == 'Passé' %}
                        Fermé
                    {% endif %}
                </td>
                {# todo : si on est actif pour cet evenement (manque les relations) mettre un if puis 'X' si true #}
                <td>{participant.actif}</td>
                {# todo: Orgnaisateur via relation #}
                <td>{Jacques}</td>
                <td>
                    {% if app.user %}
                        {# todo: Changer les cjumeline par les {organisateur.id ou .mail} #}
                        {% if app.user.mail == "cjumelinee@tutanota.com" %}
                            {% if sortie.etat == 'Créée' %}
                                <a href="{{ path('sortie_edit',{'id' : sortie.id} )}}">Modifier</a>
                                <a href="{{ path('sortie_edit',{'id' : sortie.id} )}}">Publier</a>
                            {% endif %}
                            {% if sortie.etat == 'Ouverte' %}
                                <a href="{{ path('sortie_edit',{'id' : sortie.id})}}">Modifier</a>
                                {#  <a href="{{ path('',{'id' : sortie.id})}}">Annuler</a>#}
                            {% endif %}
                            {% if sortie.etat == 'Annulée' %}
                                <a href="{{ path('sorties_edit',{'id' : sortie.id} )}}">Modifier</a>
                                {#  <a href="{{ path('',{'id' : sortie.id})}}">Annuler</a>#}
                            {% endif %}
                        {% endif %}
                        {% if app.user.mail != "ajouter le mail de l'organisateur" %}
                            {% if app.user.mail != "cjumelinee@tutanota.com" %}
                                {% if sortie.etat == 'Ouverte' %}
                                    {% if app.user.actif == 0 %}
                                        <a href="{{ path('sorties_edit',{'id' : sortie.id} )}}">Participer</a>
                                        @@ -101,6 +116,11 @@
                                        <a href="{{ path('sorties_edit',{'id' : sortie.id} )}}">Se désister</a>
                                    {% endif %}
                                {% endif %}
                                {% if sortie.etat == 'Cloturée' %}
                                    {% if app.user.actif == 1  %}
                                        <a href="{{ path('sorties_edit',{'id' : sortie.id} )}}">Se désister</a>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="9">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

   {# <a href="{{ path('sortie_new') }}">Creer une nouvelle Sortie</a> #}
{% endblock %}

 {# {% if sortie == 'Afficher' %}
                        <td>
                            <a href="{{ path('sorties_details',{ id : sortie[0]}) }}">{{ sortie[i]}}</a>
                        </td>
                    {% elseif sortie[i] == 'Modifier' %}
                        <td>
                            <a href="{{ path('sorties_edit',{ id : sortie[0]}) }}">{{ sortie[i]}}</a>
                        </td>
                    {% else %}
                            <td>{{ sortie[i]}}</td>
                    {% endif %}#}
